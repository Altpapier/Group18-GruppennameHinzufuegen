<!doctype html>
<html lang="de">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="style.css" />
        <link rel="icon" href="assets/icon_neu.png" />
        <title>Live Feedback</title>
        <script src="courseManager.js"></script>
        <script src="surveyManager.js"></script>
        <script>
            window.onload = function () {
                if (localStorage.getItem("body-dark") == "true") {
                    document.body.classList.add("dark");
                }
            };

            function toggle() {
                document.body.classList.add("transition");
                document.body.classList.toggle("dark");
                localStorage.setItem(
                    "body-dark",
                    document.body.classList.contains("dark") ? "true" : "false",
                );
            }

            function overlayPopup(elem) {
                if (elem.classList.contains("popup")) {
                    elem.classList.remove("popup");
                } else {
                    elem.classList.add("popup");
                }
            }
        </script>
    </head>
    <body>
        <header>
            <a href="kurse_lecturer.html" class="logo">
                <img src="assets/titel_logo_neu.png" alt="logo" />
            </a>
            <div class="online-state">
                <span id="dot" class="dot-offline"></span>
                <span id="online-status">Offline</span>
            </div>
            <div id="darkmode-toggle" class="light" onClick="toggle();">
                <div class="big">
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
                <div class="small"></div>
                <div class="small"></div>
                <div class="small"></div>
            </div>
        </header>
        <main class="big-main">
            <label class="top-left-Titel" id="course-name-life-lecturer">
                Grundlagen der Mensch-Computer-Interaktion
            </label>
            <div class="title-and-start-survey" name="title-and-start-survey">
                <div
                    class="start-survey-btn flex_wrap participation-box"
                    style="align-items: flex-start"
                >
                    <div class="participation">
                        <img
                            src="assets/users-dark.svg"
                            class="participation-img dark"
                            alt="Participants"
                        />
                        <img
                            src="assets/users-light.svg"
                            class="participation-img"
                            alt="Participants"
                        />
                        <span id="participant-count" class="participation-count">0</span>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem">
                        <button class="start-survey-btn" onclick="displayPopup()" style="margin: 0">
                            Umfrage starten
                        </button>
                        <button
                            class="button"
                            style="min-width: 160px; margin-top: 1rem"
                            onclick="displayJumpscarePopup()"
                        >
                            Jumpscare
                        </button>
                    </div>
                </div>
            </div>
            <div class="qrcode">
                <img src="assets/qr.png" onclick="overlayPopup(this)" />
                <a class="button" id="export" href="assets/qr.png" download="qr.png">
                    QR-Code<br />exportieren
                </a>
            </div>
            <div
                class="flex"
                style="display: none; flex-direction: column; align-items: center"
                name="overview"
                id="survey"
            >
                <h1>UMFRAGE ÜBERSICHT</h1>
                <fieldset style="background-color: #f0f0f0; padding: 2rem; min-width: 300px">
                    <h2 id="survey-title">Umfrage</h2>
                    <div id="survey-content">
                        <!-- Hier kommen die Umfrage Resultate hin :D -->
                    </div>
                </fieldset>
                <button onclick="deleteSurvey()">Umfrage beenden</button>
            </div>
            <div id="no-survey" style="display: flex; flex-direction: column; align-items: center">
                <h3>Es läuft gerade keine Umfrage.</h3>
            </div>
            <footer class="page-footer">
                <a class="bottom-center button" onclick="beenden()">Beenden</a>
            </footer>

            <div class="popup-backdrop" id="survey-popup" style="display: none">
                <div class="popup">
                    <h2>Umfrage starten</h2>
                    <div id="surveyButtonsContainer" style="width: 100%">
                        <!-- Umfragen werden hier dynamisch eingefügt -->
                    </div>
                    <button class="secondary" onclick="hidePopup()">Abbrechen</button>
                </div>
            </div>
            <div class="popup-backdrop" id="jumpscare-popup" style="display: none">
                <div class="popup">
                    <h2>Jumpscare auswählen</h2>
                    <h3>Bild:</h3>
                    <select id="jumpscare-type">
                        <option value="katze" selected>Katze</option>
                        <option value="bitti" selected>Bitti Bitti Hamster</option>
                        <option value="gesicht">Gesicht</option>
                        <option value="kurt">Kurt</option>
                    </select>
                    <h3>Audio:</h3>
                    <select id="jumpscare-audio">
                        <option value="metal-pipe" selected>Metall Rohr</option>
                        <option value="hamster" selected>Hamster</option>
                    </select>
                    <button class="button" style="margin-top: 2rem" onclick="sendJumpscare()">
                        Absenden
                    </button>
                    <button class="secondary" onclick="hideJumpscarePopup()">Abbrechen</button>
                </div>
            </div>
            <div
                id="notification-container"
                class="notification-container"
                style="top: 19rem"
            ></div>
            <div class="shortcut-hint">
                <p><strong>Shortcuts:</strong></p>
                <p><kbd>x</kbd> Löscht älteste</p>
                <p><kbd>Shift</kbd> + <kbd>x</kbd> Löscht alle</p>
            </div>
        </main>
    </body>
    <script src="liveFeedbackLecturer.js"></script>
    <script>
        let currentCourseId = null;

        // Dynamischen Kursnamen und Umfragen laden
        function loadCourseData() {
            const params = new URLSearchParams(window.location.search);
            currentCourseId = parseInt(params.get("courseId"));

            if (currentCourseId) {
                const course = courseManager.getCourseById(currentCourseId);
                if (course) {
                    document.getElementById("course-name-life-lecturer").textContent = course.name;
                    loadSurveyButtons();
                }
            }
        }

        function loadSurveyButtons() {
            const container = document.getElementById("surveyButtonsContainer");
            const surveys = surveyManager.getSurveysByCourseId(currentCourseId);

            container.innerHTML = "";

            if (surveys.length === 0) {
                container.appendChild(document.createTextNode("Keine Umfragen erstellt."));
            }

            surveys.forEach((survey) => {
                const button = document.createElement("button");
                button.type = "button";
                button.className = "button";
                button.style.width = "100%";
                button.style.marginBottom = "1rem";
                button.textContent = survey.name;
                button.onclick = () => {
                    startSurvey({
                        name: survey.name,
                        ratingType: survey.ratingType,
                        options: survey.options || [],
                    });
                    hidePopup();
                };
                container.appendChild(button);
            });
        }

        document.addEventListener("DOMContentLoaded", loadCourseData);
    </script>
</html>
