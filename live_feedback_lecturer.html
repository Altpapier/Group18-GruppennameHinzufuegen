<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="style.css" />
        <link rel="icon" href="assets/icon_neu.png" />
        <title>Live Feedback</title>
        <script src="courseManager.js"></script>
        <script src="surveyManager.js"></script>
        <script>
            function toggle() {
                document.body.classList.toggle("light");
            }
        </script>
    </head>
    <body>
        <header>
            <img src="assets/titel_logo_neu.png" alt="logo" />
        </header>
        <main class="big-main">
            <label class="top-left-Titel" id="course-name-life-lecturer"
                >Grundlagen der Mensch-Computer-Interaktion</label
            >
            <div class="title-and-start-survey" name="title-and-start-survey">
                <button class="start-survey-btn" onclick="displayPopup()">Umfrage starten</button>
            </div>
            <div
                class="flex"
                style="display: none; flex-direction: column; align-items: center"
                name="overview"
                id="survey"
            >
                <h1>UMFRAGE √úBERSICHT</h1>
                <fieldset style="background-color: #f0f0f0; padding: 2rem">
                    <h2>Wie ist das heutige T-Shirt?</h2>
                    <div style="display: flex; justify-content: center" class="overview">
                        <div class="stat-box">
                            <span class="emoji">üëç</span>
                            <h3 id="positive-feedback">42%</h3>
                        </div>
                        <div class="stat-box">
                            <span class="emoji">üëé</span>
                            <h3 id="negative-feedback">58%</h3>
                        </div>
                    </div>
                    <div class="progress-wrapper">
                        <div class="progress" role="progressbar">
                            <div class="progress-fill" id="progress-fill" style="width: 42%"></div>
                        </div>
                    </div>
                </fieldset>
                <button onclick="deleteSurvey()">Umfrage beenden</button>
            </div>
            <div id="no-survey" style="display: flex; flex-direction: column; align-items: center">
                <h3>Es l√§uft gerade keine Umfrage.</h3>
            </div>
            <footer class="page-footer">
                <a class="bottom-center button" href="/summary_lecturer.html">Beenden</a>
            </footer>

            <div class="popup-backdrop" id="survey-popup" style="display: none">
                <div class="popup">
                    <h2>Umfrage starten</h2>
                    <div id="surveyButtonsContainer">
                        <!-- Umfragen werden hier dynamisch eingef√ºgt -->
                    </div>
                    <button class="secondary" onclick="hidePopup()">Abbrechen</button>
                </div>
            </div>
            <div id="notification-container" class="notification-container"></div>
        </main>
    </body>
    <script src="liveFeedbackLecturer.js"></script>
    <script>
        let currentCourseId = null;

        // Dynamischen Kursnamen und Umfragen laden
        function loadCourseData() {
            const params = new URLSearchParams(window.location.search);
            currentCourseId = parseInt(params.get('courseId'));
            
            if (currentCourseId) {
                const course = courseManager.getCourseById(currentCourseId);
                if (course) {
                    document.getElementById('course-name-life-lecturer').textContent = course.name;
                    loadSurveyButtons();
                }
            }
        }

        function loadSurveyButtons() {
            const container = document.getElementById('surveyButtonsContainer');
            const surveys = surveyManager.getSurveysByCourseId(currentCourseId);
            
            container.innerHTML = '';
            
            if (surveys.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center;">Keine Umfragen f√ºr diesen Kurs.</p>';
                return;
            }
            
            surveys.forEach(survey => {
                const button = document.createElement('button');
                button.type = 'button';
                button.style.cssText = 'width: 100%; padding: 10px; margin-bottom: 10px;';
                button.textContent = survey.name;
                button.onclick = () => {
                    startSurvey();
                    hidePopup();
                };
                container.appendChild(button);
            });
        }

        document.addEventListener('DOMContentLoaded', loadCourseData);
    </script>
</html>
